#!/bin/bash

# Inspired (or shamelessly copied from https://github.com/mattjmorrison/dotfiles)

set -e

#==============
# Variables
#==============
dotfiles_dir=$(dirname "$(readlink -f "$0")")

create_link() {
  ln -sf $1 $2
  echo "  $1 -> $2"
}

#==============
# Create symlinks in the home folder
#==============
echo "Creating symlinks:"
create_link "$dotfiles_dir/bash/.bashrc" ~/.bashrc
create_link "$dotfiles_dir/bash/.bash_aliases" ~/.bash_aliases
create_link "$dotfiles_dir/git/.gitconfig" ~/.gitconfig

#==============
# Set bash as the default shell (if not already bash)
#==============
if [ "$SHELL" != "/bin/bash" ] && [ -f /bin/bash ]; then
  echo "Changing default shell to bash..."
  chsh -s /bin/bash
elif [ ! -f /bin/bash ]; then
  echo "Warning: /bin/bash not found, skipping shell change"
fi

#==============
# Setup opencode service
#==============
if [ -f "$dotfiles_dir/opencode/service" ]; then
  echo ""
  echo "Setting up opencode service..."
  bash "$dotfiles_dir/opencode/service"
fi


#==============
# Done
#==============
echo ""
echo "====== Summary ======"
echo "Dotfiles installed successfully!"
echo "Restart your shell or run: source ~/.bashrc"
echo "Enjoy -Alv"
